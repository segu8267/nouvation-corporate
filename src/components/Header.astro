---
// Header Component
---

<header id="smart-header" class="fixed w-full top-0 z-[70] transition-opacity duration-700 ease-in-out">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <div class="flex justify-between items-center h-20">
      <!-- Logo -->
      <a href="/" class="hover:opacity-80 transition-opacity focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded relative z-[80]" aria-label="NOUVATION トップページへ">
        <img src="/images/logo.png" alt="NOUVATION" class="h-8 md:h-10 w-auto" />
      </a>

      <!-- PC Navigation -->
      <nav id="pc-nav" class="hidden md:flex space-x-8 text-sm font-bold transition-colors duration-300" aria-label="メインナビゲーション">
        <a href="#news" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">News</a>
        <a href="#mission" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Mission</a>
        <a href="#services" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Services</a>
        <a href="#story" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Story</a>
        <a href="#voice" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Voice</a>
      </nav>

      <!-- PC CTA Button -->
      <div class="hidden md:block">
        <a 
          href="#" 
          class="px-6 py-3 bg-[#d5db00] text-[#352421] text-sm font-bold rounded-full hover:bg-[#d5db00]/90 transition-all hover:shadow-lg hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-[#d5db00] focus:ring-offset-2 focus:ring-offset-transparent min-h-[44px] flex items-center justify-center"
          aria-label="LINE公式アカウントに登録する"
        >
          LINE登録
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button 
        id="menu-toggle"
        type="button"
        class="menu-toggle md:hidden p-2 text-[#231815] hover:text-[#231815]/80 transition-colors focus:outline-none rounded min-w-[44px] min-h-[44px] flex items-center justify-center relative z-[80]"
        aria-label="メニューを開く"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <nav id="mobile-menu" class="md:hidden fixed inset-0 bg-[#F6F6EE] z-[60] hidden" aria-label="モバイルメニュー">
    <div class="h-full flex flex-col pt-20">
      <div class="flex-1 overflow-y-auto px-4 py-8 space-y-6">
        <a href="#news" class="block text-lg font-bold text-[#231815] hover:text-[#231815]/80 transition-colors py-3">News</a>
        <a href="#mission" class="block text-lg font-bold text-[#231815] hover:text-[#231815]/80 transition-colors py-3">Mission</a>
        <a href="#services" class="block text-lg font-bold text-[#231815] hover:text-[#231815]/80 transition-colors py-3">Services</a>
        <a href="#story" class="block text-lg font-bold text-[#231815] hover:text-[#231815]/80 transition-colors py-3">Story</a>
        <a href="#voice" class="block text-lg font-bold text-[#231815] hover:text-[#231815]/80 transition-colors py-3">Voice</a>
        <div class="pt-6 border-t border-[#231815]/20 mt-6">
          <a 
            href="#" 
            class="block w-full text-center px-6 py-4 bg-[#d5db00] text-[#352421] text-base font-bold rounded-full hover:bg-[#d5db00]/90 transition-colors"
          >
            LINE登録
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  // Smart Header: Show/Hide on Scroll
  let lastScrollY = 0;
  const header = document.getElementById('smart-header');
  const pcNav = document.getElementById('pc-nav');
  const navLinks = document.querySelectorAll('.nav-link');
  const menuToggle = document.getElementById('menu-toggle');

  // 背景色を検出してテキスト色を変更する関数
  function detectBackgroundColor() {
    if (!header) return;

    const headerRect = header.getBoundingClientRect();
    const headerBottom = headerRect.bottom;
    
    // ヘッダーの下の位置にあるセクションを検出
    const sections = document.querySelectorAll('section');
    let currentSection = null;

    // ヘッダーの下に位置するセクションを探す
    for (const section of sections) {
      const rect = section.getBoundingClientRect();
      // ヘッダーの下端がセクション内にあるか、またはセクションの上端がヘッダーの下にある場合
      if (rect.top <= headerBottom && rect.bottom >= headerRect.top) {
        currentSection = section;
        break;
      }
    }

    // FVセクション（最初のセクション）の場合は黒背景と判定
    if (!currentSection || currentSection.id === '') {
      // FVセクション内（黒背景）なので白文字
      setTextColor('light');
      return;
    }

    // セクションの背景色クラスを確認
    const bgClass = Array.from(currentSection.classList).find(cls => 
      cls.startsWith('bg-')
    );
    
    // 白っぽい背景かどうかを判定（#F6F6EE, #F0ECDE）
    const isLightBg = bgClass && (
      bgClass.includes('F6F6EE') || 
      bgClass.includes('F0ECDE') ||
      bgClass.includes('F4F4F5') || 
      bgClass.includes('white') || 
      bgClass.includes('gray-50') ||
      bgClass.includes('gray-100') ||
      bgClass.includes('gray-200')
    );

    if (isLightBg) {
      // 白背景なので黒文字
      setTextColor('dark');
    } else {
      // 黒背景なので白文字
      setTextColor('light');
    }
  }

  // テキスト色を設定する関数
  function setTextColor(mode) {
    if (mode === 'dark') {
      // 黒文字（白背景用）
      navLinks.forEach(link => {
        link.style.color = '#1F2937';
      });
      if (menuToggle) {
        menuToggle.style.color = '#1F2937';
      }
    } else {
      // 白文字（黒背景用）
      navLinks.forEach(link => {
        link.style.color = '#E5E7EB';
      });
      if (menuToggle) {
        menuToggle.style.color = '#E5E7EB';
      }
    }
  }

  function updateHeader() {
    const currentScrollY = window.scrollY;

    // Hide on scroll down, show on scroll up using opacity
    if (currentScrollY > lastScrollY && currentScrollY > 100) {
      header?.style.setProperty('opacity', '0');
      header?.style.setProperty('pointer-events', 'none');
    } else {
      header?.style.setProperty('opacity', '1');
      header?.style.setProperty('pointer-events', 'auto');
      // ヘッダーが表示されている時だけ背景色を検出
      detectBackgroundColor();
    }
    
    lastScrollY = currentScrollY;
  }

  // スクロール時にも背景色を検出（PCのみ）
  if (window.innerWidth >= 768) {
    window.addEventListener('scroll', detectBackgroundColor, { passive: true });
  }

  // 初期状態でも背景色を検出
  window.addEventListener('load', () => {
    detectBackgroundColor();
  });

  // リサイズ時にも背景色を再検出
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768) {
      detectBackgroundColor();
    }
  }, { passive: true });

  window.addEventListener('scroll', updateHeader, { passive: true });

  // Mobile Menu Toggle
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  function openMobileMenu() {
    mobileMenu?.classList.remove('hidden');
    menuIcon?.classList.add('hidden');
    closeIcon?.classList.remove('hidden');
    menuToggle?.setAttribute('aria-expanded', 'true');
    menuToggle?.setAttribute('aria-label', 'メニューを閉じる');
    document.body.style.overflow = 'hidden'; // スクロールを無効化
    // ヘッダーの背景色を変更
    if (header) {
      header.style.backgroundColor = '#F6F6EE';
    }
  }

  function closeMobileMenu() {
    mobileMenu?.classList.add('hidden');
    menuIcon?.classList.remove('hidden');
    closeIcon?.classList.add('hidden');
    menuToggle?.setAttribute('aria-expanded', 'false');
    menuToggle?.setAttribute('aria-label', 'メニューを開く');
    document.body.style.overflow = ''; // スクロールを有効化
    // ヘッダーの背景色を元に戻す
    if (header) {
      header.style.backgroundColor = '';
    }
  }

  menuToggle?.addEventListener('click', () => {
    const isOpen = !mobileMenu?.classList.contains('hidden');
    
    if (isOpen) {
      closeMobileMenu();
    } else {
      openMobileMenu();
    }
  });

  // Close menu when clicking nav links
  const mobileLinks = document.querySelectorAll('#mobile-menu a[href^="#"]');
  mobileLinks.forEach(link => {
    link.addEventListener('click', () => {
      closeMobileMenu();
    });
  });
</script>
---
// Header Component
---

<header id="smart-header" class="fixed w-full top-0 z-[70] transition-all duration-700 ease-in-out">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <div class="flex justify-between items-center h-20 md:h-16">
      <!-- Logo -->
      <a href="/" id="header-logo" class="hover:opacity-80 transition-opacity focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded relative z-[80]" aria-label="NOUVATION トップページへ">
        <img src="/images/logo.svg" alt="NOUVATION" class="h-8 md:h-10 w-auto" />
      </a>

      <!-- PC Navigation -->
      <nav id="pc-nav" class="hidden md:flex space-x-8 text-sm font-bold transition-colors duration-300" aria-label="メインナビゲーション">
        <a href="#news" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">News</a>
        <a href="#mission" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Mission</a>
        <a href="#services" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Services</a>
        <a href="#story" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Story</a>
        <a href="#voice" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none focus:ring-2 focus:ring-[#D4FF00] focus:ring-offset-2 focus:ring-offset-[#111111] rounded px-2 py-1">Voice</a>
      </nav>

      <!-- PC CTA Button -->
      <div class="hidden md:block">
        <a 
          href="#" 
          class="px-6 py-3 bg-[#d5db00] text-[#352421] text-sm font-bold rounded-full hover:bg-[#d5db00]/90 transition-all hover:-translate-y-0.5 focus:outline-none min-h-[44px] flex items-center justify-center"
          aria-label="LINE公式アカウントに登録する"
        >
          LINE登録
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button 
        id="menu-toggle"
        type="button"
        class="menu-toggle md:hidden p-2 text-white hover:text-white/80 transition-colors focus:outline-none rounded min-w-[44px] min-h-[44px] flex items-center justify-center relative z-[80]"
        aria-label="メニューを開く"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <nav id="mobile-menu" class="md:hidden fixed inset-0 bg-[#464237] z-[60] hidden" aria-label="モバイルメニュー">
    <div class="h-full flex flex-col pt-20">
      <div class="flex-1 overflow-y-auto px-4 py-8 space-y-6">
        <a href="#news" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">News</a>
        <a href="#mission" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Mission</a>
        <a href="#services" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Services</a>
        <a href="#story" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Story</a>
        <a href="#voice" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Voice</a>
        <div class="pt-6 border-t border-white/20 mt-6">
          <a 
            href="#" 
            class="block w-full text-center px-6 py-4 bg-[#d5db00] text-[#352421] text-base font-bold rounded-full hover:bg-[#d5db00]/90 transition-colors"
          >
            LINE登録
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
  /* Glassmorphism Header Styles */
  #smart-header {
    background-color: transparent;
    padding: 0;
  }
  
  #smart-header .max-w-7xl {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* モバイル: スクロール時はシンプルなグラスモーフィズム */
  #smart-header.scrolled {
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
  }
  
  /* PC: スクロール時は角丸＋独立デザイン */
  @media (min-width: 768px) {
    #smart-header.scrolled {
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
    }
    
    #smart-header.scrolled .max-w-7xl {
      margin: 1rem auto;
      border-radius: 9999px;
      padding: 0.5rem 2rem;
      backdrop-filter: blur(12px) saturate(180%);
      -webkit-backdrop-filter: blur(12px) saturate(180%);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    }
  }
  
  /* ガラスモーフィズム背景色（白寄り・共通） */
  #smart-header.scrolled {
    background-color: rgba(255, 255, 255, 0.6);
  }
  
  /* PC: 角丸ヘッダーの背景色 */
  @media (min-width: 768px) {
    #smart-header.scrolled {
      background-color: transparent;
    }
    
    #smart-header.scrolled .max-w-7xl {
      background-color: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(0, 0, 0, 0.08);
    }
  }
  
  /* ロゴとナビゲーションの色 */
  /* 最上部（透過時）: 白文字（FVの黒背景に対応） */
  #smart-header #header-logo img {
    filter: brightness(0) saturate(100%) invert(100%);
    transition: filter 0.4s ease;
  }
  
  #smart-header .nav-link {
    color: #E5E7EB;
    transition: color 0.4s ease;
  }
  
  #smart-header #menu-toggle {
    color: #E5E7EB;
    transition: color 0.4s ease;
  }
  
  /* スクロール後（ガラス背景時）: 黒文字 */
  #smart-header.scrolled #header-logo img {
    filter: brightness(0) saturate(100%) invert(8%) sepia(10%) saturate(1000%) hue-rotate(180deg);
  }
  
  #smart-header.scrolled .nav-link {
    color: #1F2937;
  }
  
  #smart-header.scrolled .nav-link:hover {
    opacity: 0.7;
  }
  
  #smart-header.scrolled #menu-toggle {
    color: #1F2937;
  }
</style>

<script>
  // ============================================
  // Glassmorphism Header with Smart Show/Hide
  // ============================================
  let lastScrollY = 0;
  const header = document.getElementById('smart-header');
  const menuToggle = document.getElementById('menu-toggle');

  function updateHeader() {
    if (!header) return;
    
    const currentScrollY = window.scrollY;

    // スクロール量に応じてグラスモーフィズムを適用
    if (currentScrollY > 50) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }

    // Hide on scroll down, show on scroll up
    if (currentScrollY > lastScrollY && currentScrollY > 100) {
      header.style.opacity = '0';
      header.style.pointerEvents = 'none';
    } else {
      header.style.opacity = '1';
      header.style.pointerEvents = 'auto';
    }
    
    lastScrollY = currentScrollY;
  }

  window.addEventListener('scroll', updateHeader, { passive: true });
  
  // 初期実行
  updateHeader();

  // Mobile Menu Toggle
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  function openMobileMenu() {
    mobileMenu?.classList.remove('hidden');
    menuIcon?.classList.add('hidden');
    closeIcon?.classList.remove('hidden');
    menuToggle?.setAttribute('aria-expanded', 'true');
    menuToggle?.setAttribute('aria-label', 'メニューを閉じる');
    document.body.style.overflow = 'hidden'; // スクロールを無効化
    // ヘッダーの背景色を変更
    if (header) {
      header.style.backgroundColor = '#464237';
    }
    // メニューボタンとロゴを白色に
    if (menuToggle) {
      (menuToggle as HTMLElement).style.color = '#FFFFFF';
    }
    const logoImg = document.querySelector('#header-logo img') as HTMLImageElement | null;
    if (logoImg) {
      logoImg.style.filter = 'brightness(0) saturate(100%) invert(100%)';
    }
  }

  function closeMobileMenu() {
    mobileMenu?.classList.add('hidden');
    menuIcon?.classList.remove('hidden');
    closeIcon?.classList.add('hidden');
    menuToggle?.setAttribute('aria-expanded', 'false');
    menuToggle?.setAttribute('aria-label', 'メニューを開く');
    document.body.style.overflow = ''; // スクロールを有効化
    // ヘッダーの背景色を元に戻す
    if (header) {
      header.style.backgroundColor = '';
    }
  }

  menuToggle?.addEventListener('click', () => {
    const isOpen = !mobileMenu?.classList.contains('hidden');
    
    if (isOpen) {
      closeMobileMenu();
    } else {
      openMobileMenu();
    }
  });

  // Close menu when clicking nav links
  const mobileLinks = document.querySelectorAll('#mobile-menu a[href^="#"]');
  mobileLinks.forEach(link => {
    link.addEventListener('click', () => {
      closeMobileMenu();
    });
  });
</script>
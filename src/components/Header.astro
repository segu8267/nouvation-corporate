---
// Header Component
---

<header id="smart-header" class="fixed w-full top-0 z-[70] transition-all duration-700 ease-in-out">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <div class="flex justify-between items-center h-20 md:h-16">
      <!-- Logo -->
      <a href="/" id="header-logo" class="hover:opacity-80 transition-opacity focus:outline-none rounded relative z-[80]" aria-label="NOUVATION トップページへ">
        <img src="/images/logo.svg" alt="NOUVATION" class="h-8 md:h-10 w-auto" />
      </a>

      <!-- PC Navigation -->
      <nav id="pc-nav" class="hidden md:flex space-x-8 text-sm font-bold transition-colors duration-300" aria-label="メインナビゲーション">
        <a href="#news" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none rounded px-2 py-1">News</a>
        <a href="#mission" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none rounded px-2 py-1">Mission</a>
        <a href="#services" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none rounded px-2 py-1">Services</a>
        <a href="#story" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none rounded px-2 py-1">Story</a>
        <a href="#voice" class="nav-link hover:text-[#D4FF00] transition-colors focus:outline-none rounded px-2 py-1">Voice</a>
      </nav>

      <!-- PC CTA Button -->
      <div class="hidden md:block">
        <a 
          href="#" 
          class="px-6 py-3 bg-[#2e7d32] text-white text-sm font-bold rounded-full hover:bg-[#2e7d32]/90 transition-all hover:-translate-y-0.5 focus:outline-none min-h-[44px] flex items-center justify-center"
          aria-label="LINE公式アカウントに登録する"
        >
          LINE登録
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button 
        id="menu-toggle"
        type="button"
        class="menu-toggle md:hidden p-2 text-white hover:text-white/80 transition-colors focus:outline-none rounded min-w-[44px] min-h-[44px] flex items-center justify-center relative z-[80]"
        aria-label="メニューを開く"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <nav id="mobile-menu" class="md:hidden fixed inset-0 bg-[#464237] z-[75] hidden" aria-label="モバイルメニュー">
    <div class="h-full flex flex-col pt-20">
      <div class="flex-1 overflow-y-auto px-4 py-8 space-y-6">
        <a href="#news" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">News</a>
        <a href="#mission" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Mission</a>
        <a href="#services" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Services</a>
        <a href="#story" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Story</a>
        <a href="#voice" class="block text-lg font-bold text-white hover:text-white/80 transition-colors py-3">Voice</a>
        <div class="pt-6 border-t border-white/20 mt-6">
          <a 
            href="#" 
            class="block w-full text-center px-6 py-4 bg-[#2e7d32] text-white text-base font-bold rounded-full hover:bg-[#2e7d32]/90 transition-colors"
          >
            LINE登録
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
  /* Glassmorphism Header Styles */
  #smart-header {
    background-color: transparent;
    padding: 0;
  }
  
  #smart-header .max-w-7xl {
    /* 背景と色を先に変更（速い） */
    transition: backdrop-filter 0.2s ease,
                background-color 0.2s ease,
                box-shadow 0.2s ease,
                /* 高さとレイアウトは後から変更（遅い） */
                margin 0.3s ease 0.1s,
                border-radius 0.3s ease 0.1s,
                padding 0.3s ease 0.1s,
                height 0.3s ease 0.1s;
  }
  
  #smart-header .max-w-7xl > div {
    /* 高さの変更は後から */
    transition: height 0.3s ease 0.1s;
  }
  
  /* モバイル: スクロール時は角丸＋独立デザイン */
  #smart-header.scrolled {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
  }
  
  /* モバイル: スクロール時は角丸＋独立デザイン（高さ45px） */
  #smart-header.scrolled .max-w-7xl {
    margin: 16px 12px;
    border-radius: 9999px;
    padding: 0.375rem 1.5rem;
    height: 45px;
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    background-color: rgba(255, 255, 255, 0.6);
    border: none;
    display: flex;
    align-items: center;
  }
  
  /* ガラス背景時、メニューが開いている時のロゴとボタンの余白を下と揃える */
  #smart-header.scrolled .max-w-7xl > div {
    padding-left: 0;
    padding-right: 0;
  }
  
  #smart-header.scrolled .max-w-7xl > div {
    height: 100% !important;
    min-height: 0 !important;
    max-height: 100% !important;
    flex: 1;
    padding-left: 0;
    padding-right: 0;
  }
  
  /* 元の高さクラスを上書き（モバイルのみ） */
  #smart-header.scrolled .max-w-7xl > div.h-20 {
    height: 100% !important;
  }
  
  /* PC: スクロール時は角丸＋独立デザイン（元の高さを維持） */
  @media (min-width: 768px) {
    #smart-header.scrolled .max-w-7xl {
      margin: 16px auto; /* 左右中央寄せ */
      padding: 0.5rem 2rem;
      height: auto;
      /* コンテンツ幅に合わせる（max-w-7xl = 1280px から左右パディング分を引いた幅） */
      width: calc(100% - 48px); 
      max-width: 1232px; /* 1280px - 48px */
    }
    
    #smart-header.scrolled .max-w-7xl > div {
      height: 4rem !important; /* h-16 = 64px */
    }
  }
  
  /* ガラスモーフィズム背景色（共通） */
  #smart-header.scrolled {
    background-color: transparent;
  }
  
  /* ロゴとナビゲーションの色 */
  /* 最上部（透過時）: 白文字（FVの黒背景に対応） */
  #smart-header #header-logo img {
    filter: brightness(0) saturate(100%) invert(100%);
    transition: filter 0.2s ease;
  }
  
  #smart-header .nav-link {
    color: #E5E7EB;
    transition: color 0.2s ease;
  }
  
  #smart-header #menu-toggle {
    color: #E5E7EB;
    transition: color 0.2s ease;
  }
  
  #smart-header #menu-toggle svg {
    transition: stroke 0.2s ease;
  }
  
  /* スクロール後（ガラス背景時）: 黒文字 */
  #smart-header.scrolled #header-logo img {
    filter: brightness(0) saturate(100%);
    transition: filter 0.2s ease;
  }
  
  #smart-header.scrolled .nav-link {
    color: #1F2937;
    transition: color 0.2s ease;
  }
  
  #smart-header.scrolled .nav-link:hover {
    opacity: 0.7;
  }
  
  #smart-header.scrolled #menu-toggle {
    color: #000000;
    transition: color 0.2s ease;
  }
  
  #smart-header.scrolled #menu-toggle svg {
    stroke: #000000;
    transition: stroke 0.2s ease;
  }
</style>

<script>
  // ============================================
  // Glassmorphism Header with Smart Show/Hide
  // ============================================
  let lastScrollY = 0;
  const header = document.getElementById('smart-header');
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  function updateHeaderColors() {
    if (!header) return;
    const isScrolled = header.classList.contains('scrolled');
    const menuToggleEl = document.getElementById('menu-toggle');
    const menuIconEl = document.getElementById('menu-icon');
    const closeIconEl = document.getElementById('close-icon');
    const logoImg = document.querySelector('#header-logo img') as HTMLImageElement | null;
    const isMenuOpen = !mobileMenu?.classList.contains('hidden');
    
    // メニューが開いている時は白
    if (isMenuOpen) {
      if (menuToggleEl) {
        (menuToggleEl as HTMLElement).style.color = '#FFFFFF';
      }
      if (menuIconEl) {
        (menuIconEl as Element).setAttribute('stroke', '#FFFFFF');
      }
      if (closeIconEl) {
        (closeIconEl as Element).setAttribute('stroke', '#FFFFFF');
      }
      if (logoImg) {
        logoImg.style.filter = 'brightness(0) saturate(100%) invert(100%)';
      }
    } else {
      // メニューが閉じている時は、スクロール状態に応じて
      if (isScrolled) {
        // ガラス背景時は黒
        if (menuToggleEl) {
          (menuToggleEl as HTMLElement).style.color = '#000000';
        }
        if (menuIconEl) {
          (menuIconEl as Element).setAttribute('stroke', '#000000');
        }
        if (closeIconEl) {
          (closeIconEl as Element).setAttribute('stroke', '#000000');
        }
        if (logoImg) {
          logoImg.style.filter = 'brightness(0) saturate(100%)';
        }
      } else {
        // 最上部は白
        if (menuToggleEl) {
          (menuToggleEl as HTMLElement).style.color = '#E5E7EB';
        }
        if (menuIconEl) {
          (menuIconEl as Element).setAttribute('stroke', '#E5E7EB');
        }
        if (closeIconEl) {
          (closeIconEl as Element).setAttribute('stroke', '#E5E7EB');
        }
        if (logoImg) {
          logoImg.style.filter = 'brightness(0) saturate(100%) invert(100%)';
        }
      }
    }
  }

  function updateHeader() {
    if (!header) return;
    
    const currentScrollY = window.scrollY;

    // スクロール量に応じてグラスモーフィズムを適用
    if (currentScrollY > 50) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }

    // Hide on scroll down, show on scroll up
    if (currentScrollY > lastScrollY && currentScrollY > 100) {
      header.style.opacity = '0';
      header.style.pointerEvents = 'none';
    } else {
      header.style.opacity = '1';
      header.style.pointerEvents = 'auto';
    }
    
    // 色を更新（メニューが開いていない時のみ）
    const isMenuOpen = !mobileMenu?.classList.contains('hidden');
    if (!isMenuOpen) {
      updateHeaderColors();
    }
    
    lastScrollY = currentScrollY;
  }

  window.addEventListener('scroll', updateHeader, { passive: true });
  
  // 初期実行
  updateHeader();
  updateHeaderColors();

  function openMobileMenu() {
    mobileMenu?.classList.remove('hidden');
    menuIcon?.classList.add('hidden');
    closeIcon?.classList.remove('hidden');
    menuToggle?.setAttribute('aria-expanded', 'true');
    menuToggle?.setAttribute('aria-label', 'メニューを閉じる');
    document.body.style.overflow = 'hidden'; // スクロールを無効化
    // ヘッダーの背景色を変更
    if (header) {
      header.style.backgroundColor = '#464237';
      header.style.zIndex = '80'; // メニューの上に表示
    }
    // ガラス背景の角丸部分の背景を統一
    const maxWidthEl = header?.querySelector('.max-w-7xl') as HTMLElement | null;
    if (maxWidthEl) {
      maxWidthEl.style.backgroundColor = '#464237';
      maxWidthEl.style.backdropFilter = 'none';
      maxWidthEl.style.setProperty('-webkit-backdrop-filter', 'none');
    }
    // メニューボタンとロゴを白色に（即座に適用・確実に）
    const menuToggleEl = document.getElementById('menu-toggle');
    const menuIconEl = document.getElementById('menu-icon');
    const closeIconEl = document.getElementById('close-icon');
    const logoImg = document.querySelector('#header-logo img') as HTMLImageElement | null;
    const logoLink = document.getElementById('header-logo');
    
    if (menuToggleEl) {
      (menuToggleEl as HTMLElement).style.color = '#FFFFFF';
      (menuToggleEl as HTMLElement).style.zIndex = '100';
    }
    if (menuIconEl) {
      (menuIconEl as Element).setAttribute('stroke', '#FFFFFF');
    }
    if (closeIconEl) {
      (closeIconEl as Element).setAttribute('stroke', '#FFFFFF');
      (closeIconEl as Element).setAttribute('fill', 'none');
      // 確実に白色にするため、styleも設定
      (closeIconEl as HTMLElement).style.color = '#FFFFFF';
    }
    if (logoImg) {
      logoImg.style.filter = 'brightness(0) saturate(100%) invert(100%)';
      logoImg.style.display = 'block';
      logoImg.style.opacity = '1';
    }
    if (logoLink) {
      (logoLink as HTMLElement).style.zIndex = '100';
    }
    
    // 念のためupdateHeaderColorsも呼ぶ（メニューが開いている時は白色になる）
    setTimeout(() => {
      updateHeaderColors();
    }, 0);
  }

  function closeMobileMenu() {
    mobileMenu?.classList.add('hidden');
    menuIcon?.classList.remove('hidden');
    closeIcon?.classList.add('hidden');
    menuToggle?.setAttribute('aria-expanded', 'false');
    menuToggle?.setAttribute('aria-label', 'メニューを開く');
    document.body.style.overflow = ''; // スクロールを有効化
    // ヘッダーの背景色とz-indexを元に戻す
    if (header) {
      header.style.backgroundColor = '';
      header.style.zIndex = '';
    }
    // ガラス背景の角丸部分のスタイルを元に戻す
    const maxWidthEl = header?.querySelector('.max-w-7xl') as HTMLElement | null;
    if (maxWidthEl) {
      maxWidthEl.style.backgroundColor = '';
      maxWidthEl.style.backdropFilter = '';
      maxWidthEl.style.removeProperty('-webkit-backdrop-filter');
    }
    const menuToggleEl = document.getElementById('menu-toggle');
    const logoLink = document.getElementById('header-logo');
    if (menuToggleEl) {
      (menuToggleEl as HTMLElement).style.zIndex = '';
    }
    if (logoLink) {
      (logoLink as HTMLElement).style.zIndex = '';
    }
    // スクロール状態に応じて色を更新
    updateHeaderColors();
  }

  menuToggle?.addEventListener('click', () => {
    const isOpen = !mobileMenu?.classList.contains('hidden');
    
    if (isOpen) {
      closeMobileMenu();
    } else {
      openMobileMenu();
    }
  });

  // Close menu when clicking nav links
  const mobileLinks = document.querySelectorAll('#mobile-menu a[href^="#"]');
  mobileLinks.forEach(link => {
    link.addEventListener('click', () => {
      closeMobileMenu();
    });
  });
</script>